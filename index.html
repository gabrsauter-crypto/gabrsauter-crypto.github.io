<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIValidate | Intelligente KI-Strukturierung</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        .glass-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(226, 232, 240, 1);
        }
        .ai-glow {
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.2);
        }
        .step-transition { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .loader {
            border: 2px solid #f3f3f3;
            border-radius: 50%;
            border-top: 2px solid #6366f1;
            width: 14px;
            height: 14px;
            animation: spin 0.8s linear infinite;
            display: inline-block;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .thinking-bubble {
            position: relative;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 1rem;
        }
        .thinking-bubble::after {
            content: '';
            position: absolute;
            top: -8px;
            right: 20px;
            width: 16px;
            height: 16px;
            background: #f8fafc;
            border-left: 1px solid #e2e8f0;
            border-top: 1px solid #e2e8f0;
            transform: rotate(45deg);
        }
    </style>
</head>
<body class="bg-[#f1f5f9] min-h-screen">

    <!-- Top Navigation -->
    <nav class="bg-white/80 backdrop-blur-md border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-indigo-600 to-blue-500 rounded-xl flex items-center justify-center shadow-lg shadow-indigo-200">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    </div>
                    <span class="text-2xl font-black tracking-tight text-slate-800">
                        AI<span class="text-indigo-600">Validate</span>
                    </span>
                </div>
                <div class="flex items-center gap-4 text-sm font-medium text-slate-500">
                    <span class="hidden sm:inline">Version 2.0 (DeepThinking)</span>
                    <div class="h-4 w-[1px] bg-slate-200"></div>
                    <button class="hover:text-indigo-600 transition">Hilfe</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-6xl mx-auto py-8 px-4">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            
            <!-- Side Navigation -->
            <aside class="lg:col-span-1">
                <div class="glass-card rounded-2xl p-6 sticky top-24 shadow-sm">
                    <h3 class="text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em] mb-6">Arbeitsablauf</h3>
                    <nav class="space-y-1">
                        <div id="nav-1" class="nav-item flex items-center gap-3 p-3 rounded-xl transition-all duration-200 bg-indigo-50 text-indigo-700 font-semibold border border-indigo-100">
                            <span class="w-6 h-6 rounded-md bg-indigo-600 text-white text-[10px] flex items-center justify-center">01</span>
                            <span class="text-sm">Aufgabe</span>
                        </div>
                        <div id="nav-2" class="nav-item flex items-center gap-3 p-3 rounded-xl text-slate-400 hover:bg-slate-50 transition-all duration-200">
                            <span class="w-6 h-6 rounded-md bg-slate-200 text-slate-500 text-[10px] flex items-center justify-center">02</span>
                            <span class="text-sm">Kontext</span>
                        </div>
                        <div id="nav-3" class="nav-item flex items-center gap-3 p-3 rounded-xl text-slate-400 hover:bg-slate-50 transition-all duration-200">
                            <span class="w-6 h-6 rounded-md bg-slate-200 text-slate-500 text-[10px] flex items-center justify-center">03</span>
                            <span class="text-sm">Kriterien</span>
                        </div>
                        <div id="nav-4" class="nav-item flex items-center gap-3 p-3 rounded-xl text-slate-400 hover:bg-slate-50 transition-all duration-200">
                            <span class="w-6 h-6 rounded-md bg-slate-200 text-slate-500 text-[10px] flex items-center justify-center">04</span>
                            <span class="text-sm">Skalierung</span>
                        </div>
                        <div id="nav-5" class="nav-item flex items-center gap-3 p-3 rounded-xl text-slate-400 hover:bg-slate-50 transition-all duration-200">
                            <span class="w-6 h-6 rounded-md bg-slate-200 text-slate-500 text-[10px] flex items-center justify-center">05</span>
                            <span class="text-sm">Ausgabe</span>
                        </div>
                    </nav>
                </div>
            </aside>

            <!-- Main Workstation -->
            <main class="lg:col-span-3">
                <div class="glass-card rounded-3xl shadow-xl overflow-hidden min-h-[580px] flex flex-col border-none">
                    
                    <!-- Header Info mit AI Button -->
                    <div class="px-8 py-6 border-b border-slate-100 flex justify-between items-center bg-white">
                        <div>
                            <h2 id="step-title" class="text-xl font-bold text-slate-800">Aufgabe definieren</h2>
                            <p id="step-desc" class="text-sm text-slate-500">Was ist das Kernziel der KI-Unterst√ºtzung?</p>
                        </div>
                        <button onclick="thinkDeeply()" id="think-btn" class="flex items-center gap-2 bg-amber-50 text-amber-600 px-4 py-2 rounded-full text-xs font-bold hover:bg-amber-100 transition border border-amber-100">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                            <span>DeepThinking</span>
                        </button>
                    </div>

                    <!-- AI Insights Bubble (Hidden by default) -->
                    <div id="ai-insights-container" class="px-8 pt-4 hidden">
                        <div class="thinking-bubble">
                            <div class="flex items-start gap-3">
                                <span class="text-xl">üí°</span>
                                <div id="ai-insight-text" class="text-xs text-slate-600 leading-relaxed italic">
                                    Analysiere Eingabe f√ºr p√§dagogische Optimierung...
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Input Content -->
                    <div class="p-8 flex-grow">
                        <div id="step-content">
                            <!-- Dynamisch geladen -->
                             <textarea id="main-input" class="w-full h-48 p-5 bg-slate-50 border border-slate-200 rounded-2xl focus:ring-4 focus:ring-indigo-500/10 focus:border-indigo-500 outline-none transition-all text-slate-700 resize-none" placeholder="Hier Aufgabe beschreiben..."></textarea>
                        </div>

                        <!-- Kriterien Special View -->
                        <div id="criteria-view" class="hidden space-y-3">
                            <div id="criteria-list" class="space-y-3">
                                <input type="text" class="criteria-input w-full p-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Kriterium 1...">
                            </div>
                            <button onclick="addCriteriaRow()" class="text-indigo-600 text-sm font-bold flex items-center gap-1 hover:text-indigo-800 transition">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                                <span>Weiteres Kriterium</span>
                            </button>
                        </div>

                        <!-- Result Page -->
                        <div id="result-view" class="hidden">
                            <div class="bg-slate-900 rounded-2xl p-6 shadow-2xl mb-6 relative group overflow-hidden">
                                <div class="absolute top-0 right-0 p-3 flex gap-2">
                                     <button onclick="aiAction('optimize')" class="bg-indigo-600/20 hover:bg-indigo-600 text-indigo-400 hover:text-white text-[10px] font-bold px-3 py-1 rounded transition border border-indigo-500/30">Auto-Fix ‚ú®</button>
                                </div>
                                <pre id="final-prompt" class="text-indigo-400 font-mono text-sm whitespace-pre-wrap leading-relaxed max-h-[400px] overflow-y-auto"></pre>
                            </div>
                            
                            <div id="preview-area" class="hidden mb-6 p-6 bg-white border-2 border-dashed border-indigo-100 rounded-2xl">
                                <h4 class="text-xs font-black text-indigo-300 uppercase mb-3">Vorschau (Simuliertes Ergebnis)</h4>
                                <div id="preview-content" class="text-sm text-slate-600 leading-relaxed"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation Footer -->
                    <div id="footer-nav" class="p-8 bg-white border-t border-slate-100 flex justify-between items-center">
                        <button id="prev-btn" onclick="navStep(-1)" class="px-6 py-2 text-slate-400 font-bold hover:text-slate-700 transition invisible">Zur√ºck</button>
                        <div class="flex gap-4">
                             <button id="next-btn" onclick="navStep(1)" class="px-10 py-3 bg-slate-900 text-white rounded-xl font-bold shadow-xl hover:bg-indigo-600 transition-all transform hover:-translate-y-1">Weiter</button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        const apiKey = "";
        let currentStep = 1;
        const totalSteps = 5;
        
        // State storage
        const appData = {
            1: { title: "Aufgabe", desc: "Was soll die KI konkret tun?", val: "" },
            2: { title: "Kontext", desc: "Fach, Klasse, Schulform & Setting", val: "" },
            3: { title: "Kriterien", desc: "Woran wird Qualit√§t gemessen?", val: [] },
            4: { title: "Skalierung", desc: "Bewertungslogik (z.B. 1-15 Punkte)", val: "" },
            5: { title: "Ausgabe", desc: "Gew√ºnschtes Format (Tabelle, Liste, etc.)", val: "Tabelle" }
        };

        async function callGemini(prompt, system = "") {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            try {
                const res = await fetch(url, {
                    method: 'POST',
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: system }] }
                    })
                });
                const data = await res.json();
                return data.candidates[0].content.parts[0].text;
            } catch (e) { return "KI Dienst momentan nicht erreichbar."; }
        }

        async function thinkDeeply() {
            const insightBox = document.getElementById('ai-insights-container');
            const insightText = document.getElementById('ai-insight-text');
            const currentVal = currentStep === 3 ? getCriteriaString() : document.getElementById('main-input').value;
            
            if(!currentVal || currentVal.length < 5) {
                alert("Bitte geben Sie erst etwas Text ein, damit ich nachdenken kann.");
                return;
            }

            insightBox.classList.remove('hidden');
            insightText.innerHTML = '<span class="loader"></span> Analysiere p√§dagogisches Potenzial...';

            const prompt = `Analysiere den Entwurf einer Lehrkraft f√ºr diesen Schritt (${appData[currentStep].title}): "${currentVal}". Gib 2-3 kurze, hilfreiche Tipps zur Verbesserung oder was noch fehlen k√∂nnte. Sei pr√§gnant und konstruktiv. Antwortsprache Deutsch.`;
            const result = await callGemini(prompt, "Du bist ein Experte f√ºr digitale Bildung und p√§dagogisches Design.");
            
            insightText.innerText = result;
        }

        function navStep(dir) {
            saveState();
            currentStep += dir;
            
            if (currentStep > totalSteps) {
                showResult();
            } else {
                updateView();
            }
        }

        function saveState() {
            if (currentStep === 3) {
                appData[3].val = Array.from(document.querySelectorAll('.criteria-input')).map(i => i.value).filter(v => v);
            } else if (currentStep <= 5) {
                appData[currentStep].val = document.getElementById('main-input').value;
            }
        }

        function updateView() {
            const mainInput = document.getElementById('main-input');
            const criteriaView = document.getElementById('criteria-view');
            const resultView = document.getElementById('result-view');
            const insightBox = document.getElementById('ai-insights-container');

            insightBox.classList.add('hidden');
            document.getElementById('step-title').innerText = appData[currentStep].title;
            document.getElementById('step-desc').innerText = appData[currentStep].desc;

            // Nav Highlight
            document.querySelectorAll('.nav-item').forEach((item, idx) => {
                const step = idx + 1;
                if(step === currentStep) {
                    item.className = "nav-item flex items-center gap-3 p-3 rounded-xl bg-indigo-50 text-indigo-700 font-semibold border border-indigo-100";
                    item.querySelector('span:first-child').className = "w-6 h-6 rounded-md bg-indigo-600 text-white text-[10px] flex items-center justify-center";
                } else if(step < currentStep) {
                    item.className = "nav-item flex items-center gap-3 p-3 rounded-xl text-emerald-600 bg-emerald-50 border border-emerald-100";
                    item.querySelector('span:first-child').className = "w-6 h-6 rounded-md bg-emerald-500 text-white text-[10px] flex items-center justify-center";
                } else {
                    item.className = "nav-item flex items-center gap-3 p-3 rounded-xl text-slate-400";
                    item.querySelector('span:first-child').className = "w-6 h-6 rounded-md bg-slate-200 text-slate-500 text-[10px] flex items-center justify-center";
                }
            });

            if (currentStep === 3) {
                mainInput.classList.add('hidden');
                criteriaView.classList.remove('hidden');
                resultView.classList.add('hidden');
            } else {
                mainInput.classList.remove('hidden');
                criteriaView.classList.add('hidden');
                resultView.classList.add('hidden');
                mainInput.value = appData[currentStep].val;
                mainInput.placeholder = `Ihre Eingabe f√ºr ${appData[currentStep].title}...`;
            }

            document.getElementById('prev-btn').classList.toggle('invisible', currentStep === 1);
            document.getElementById('next-btn').innerText = currentStep === totalSteps ? "Fertigstellen" : "Weiter";
            document.getElementById('footer-nav').classList.remove('hidden');
            document.getElementById('think-btn').classList.remove('hidden');
        }

        function addCriteriaRow() {
            const container = document.getElementById('criteria-list');
            const input = document.createElement('input');
            input.className = "criteria-input w-full p-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none";
            input.placeholder = `Kriterium ${container.children.length + 1}...`;
            container.appendChild(input);
        }

        function getCriteriaString() {
            return Array.from(document.querySelectorAll('.criteria-input')).map(i => i.value).filter(v => v).join(', ');
        }

        function showResult() {
            document.getElementById('step-title').innerText = "Ihr Finaler Validator";
            document.getElementById('step-desc').innerText = "Kopieren Sie den Prompt f√ºr Ihre KI-Plattform.";
            document.getElementById('main-input').classList.add('hidden');
            document.getElementById('criteria-view').classList.add('hidden');
            document.getElementById('result-view').classList.remove('hidden');
            document.getElementById('think-btn').classList.add('hidden');
            document.getElementById('footer-nav').classList.add('hidden');

            const prompt = `### AI-VALIDATOR ROLE: EXCELLENT EDUCATOR\n\n` +
                `CONTEXT:\n${appData[2].val || 'Schulischer Kontext'}\n\n` +
                `TASK:\n${appData[1].val}\n\n` +
                `QUALITY CRITERIA:\n${appData[3].val.map(c => "- " + c).join('\n')}\n\n` +
                `SCALING/LOGIC:\n${appData[4].val}\n\n` +
                `OUTPUT FORMAT:\n${appData[5].val}`;

            document.getElementById('final-prompt').innerText = prompt;
        }

        async function aiAction(type) {
            const promptEl = document.getElementById('final-prompt');
            const previewArea = document.getElementById('preview-area');
            const previewContent = document.getElementById('preview-content');
            
            if (type === 'optimize') {
                promptEl.classList.add('opacity-50');
                const result = await callGemini(promptEl.innerText, "Optimiere diesen Prompt f√ºr eine KI. Nutze Chain-of-Thought Prinzipien und stelle sicher, dass die p√§dagogische Qualit√§t maximiert wird. Gib NUR den optimierten Prompt zur√ºck.");
                promptEl.innerText = result;
                promptEl.classList.remove('opacity-50');
            } else if (type === 'preview') {
                previewArea.classList.remove('hidden');
                previewContent.innerHTML = '<span class="loader"></span> Simuliere Ergebnis...';
                const result = await callGemini(promptEl.innerText, "Verhalte dich wie eine KI, die diesen Prompt erhalten hat. Erzeuge ein kurzes, realistisches Beispielergebnis f√ºr den Lehrer.");
                previewContent.innerText = result;
            }
        }

        function copyToClipboard() {
            const text = document.getElementById('final-prompt').innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert("Prompt kopiert! Sie k√∂nnen ihn jetzt in ChatGPT oder Gemini einf√ºgen.");
            });
        }

        updateView();
    </script>
</body>
</html>